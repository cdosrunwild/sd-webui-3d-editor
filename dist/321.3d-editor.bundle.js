"use strict";(self.webpackChunksd_webui_3d_editor=self.webpackChunksd_webui_3d_editor||[]).push([[321],{3321:function(t,e,n){n.r(e),n.d(e,{PLYExporter:function(){return r}});var i=n(9477);class r{parse(t,e,n={}){function r(e){t.traverse((function(t){if(!0===t.isMesh||t.isPoints){const n=t,i=n.geometry;!0===i.hasAttribute("position")&&e(n,i)}}))}const o=(n=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},n)).excludeAttributes;let l=!0,a=!1,u=!1,s=!1,f=0,d=0;t.traverse((function(t){if(!0===t.isMesh){const e=t.geometry,n=e.getAttribute("position"),i=e.getAttribute("normal"),r=e.getAttribute("uv"),o=e.getAttribute("color"),l=e.getIndex();if(void 0===n)return;f+=n.count,d+=l?l.count/3:n.count/3,void 0!==i&&(a=!0),void 0!==r&&(s=!0),void 0!==o&&(u=!0)}else if(t.isPoints){const e=t.geometry,n=e.getAttribute("position"),i=e.getAttribute("normal"),r=e.getAttribute("color");f+=n.count,void 0!==i&&(a=!0),void 0!==r&&(u=!0),l=!1}}));const c=new i.Ilk;if(l=l&&-1===o.indexOf("index"),a=a&&-1===o.indexOf("normal"),u=u&&-1===o.indexOf("color"),s=s&&-1===o.indexOf("uv"),l&&d!==Math.floor(d))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;let p=`ply\nformat ${n.binary?n.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0\nelement vertex ${f}\nproperty float x\nproperty float y\nproperty float z\n`;!0===a&&(p+="property float nx\nproperty float ny\nproperty float nz\n"),!0===s&&(p+="property float s\nproperty float t\n"),!0===u&&(p+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===l&&(p+=`element face ${d}\nproperty list uchar int vertex_index\n`),p+="end_header\n";const b=new i.Pa4,g=new i.Vkp;let y=null;if(!0===n.binary){const t=(new TextEncoder).encode(p),e=f*(12+(a?12:0)+(u?3:0)+(s?8:0)),i=l?13*d:0,o=new DataView(new ArrayBuffer(t.length+e+i));new Uint8Array(o.buffer).set(t,0);let x=t.length,m=t.length+e,A=0;r((function(t,e){const i=e.getAttribute("position"),r=e.getAttribute("normal"),f=e.getAttribute("uv"),d=e.getAttribute("color"),p=e.getIndex();g.getNormalMatrix(t.matrixWorld);for(let e=0,l=i.count;e<l;e++)b.fromBufferAttribute(i,e),b.applyMatrix4(t.matrixWorld),o.setFloat32(x,b.x,n.littleEndian),x+=4,o.setFloat32(x,b.y,n.littleEndian),x+=4,o.setFloat32(x,b.z,n.littleEndian),x+=4,!0===a&&(null!=r?(b.fromBufferAttribute(r,e),b.applyMatrix3(g).normalize(),o.setFloat32(x,b.x,n.littleEndian),x+=4,o.setFloat32(x,b.y,n.littleEndian),x+=4,o.setFloat32(x,b.z,n.littleEndian),x+=4):(o.setFloat32(x,0,n.littleEndian),x+=4,o.setFloat32(x,0,n.littleEndian),x+=4,o.setFloat32(x,0,n.littleEndian),x+=4)),!0===s&&(null!=f?(o.setFloat32(x,f.getX(e),n.littleEndian),x+=4,o.setFloat32(x,f.getY(e),n.littleEndian),x+=4):(o.setFloat32(x,0,n.littleEndian),x+=4,o.setFloat32(x,0,n.littleEndian),x+=4)),!0===u&&(null!=d?(c.fromBufferAttribute(d,e).convertLinearToSRGB(),o.setUint8(x,Math.floor(255*c.r)),x+=1,o.setUint8(x,Math.floor(255*c.g)),x+=1,o.setUint8(x,Math.floor(255*c.b)),x+=1):(o.setUint8(x,255),x+=1,o.setUint8(x,255),x+=1,o.setUint8(x,255),x+=1));if(!0===l)if(null!==p)for(let t=0,e=p.count;t<e;t+=3)o.setUint8(m,3),m+=1,o.setUint32(m,p.getX(t+0)+A,n.littleEndian),m+=4,o.setUint32(m,p.getX(t+1)+A,n.littleEndian),m+=4,o.setUint32(m,p.getX(t+2)+A,n.littleEndian),m+=4;else for(let t=0,e=i.count;t<e;t+=3)o.setUint8(m,3),m+=1,o.setUint32(m,A+t,n.littleEndian),m+=4,o.setUint32(m,A+t+1,n.littleEndian),m+=4,o.setUint32(m,A+t+2,n.littleEndian),m+=4;A+=i.count})),y=o.buffer}else{let t=0,e="",n="";r((function(i,r){const o=r.getAttribute("position"),f=r.getAttribute("normal"),p=r.getAttribute("uv"),y=r.getAttribute("color"),x=r.getIndex();g.getNormalMatrix(i.matrixWorld);for(let t=0,n=o.count;t<n;t++){b.fromBufferAttribute(o,t),b.applyMatrix4(i.matrixWorld);let n=b.x+" "+b.y+" "+b.z;!0===a&&(null!=f?(b.fromBufferAttribute(f,t),b.applyMatrix3(g).normalize(),n+=" "+b.x+" "+b.y+" "+b.z):n+=" 0 0 0"),!0===s&&(n+=null!=p?" "+p.getX(t)+" "+p.getY(t):" 0 0"),!0===u&&(null!=y?(c.fromBufferAttribute(y,t).convertLinearToSRGB(),n+=" "+Math.floor(255*c.r)+" "+Math.floor(255*c.g)+" "+Math.floor(255*c.b)):n+=" 255 255 255"),e+=n+"\n"}if(!0===l){if(null!==x)for(let e=0,i=x.count;e<i;e+=3)n+=`3 ${x.getX(e+0)+t}`,n+=` ${x.getX(e+1)+t}`,n+=` ${x.getX(e+2)+t}\n`;else for(let e=0,i=o.count;e<i;e+=3)n+=`3 ${t+e} ${t+e+1} ${t+e+2}\n`;d+=x?x.count/3:o.count/3}t+=o.count})),y=`${p}${e}${l?`${n}\n`:"\n"}`}return"function"==typeof e&&requestAnimationFrame((()=>e(y))),y}}}}]);