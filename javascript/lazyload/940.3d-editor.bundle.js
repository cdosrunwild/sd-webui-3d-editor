"use strict";(self.webpackChunksd_webui_3d_editor=self.webpackChunksd_webui_3d_editor||[]).push([[940],{1940:function(e,t,r){r.r(t),r.d(t,{ColladaExporter:function(){return i}});var n=r(9477);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===a(o)?o:String(o)),n)}var o}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"parse",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null===(r=Object.assign({version:"1.4.1",author:null,textureDirectory:"",upAxis:"Y_UP",unitName:null,unitMeter:null},r)).upAxis.match(/^[XYZ]_UP$/))return console.error("ColladaExporter: Invalid upAxis: valid values are X_UP, Y_UP or Z_UP."),null;if(null!==r.unitName&&null===r.unitMeter)return console.error("ColladaExporter: unitMeter needs to be specified if unitName is specified."),null;if(null!==r.unitMeter&&null===r.unitName)return console.error("ColladaExporter: unitName needs to be specified if unitMeter is specified."),null;""!==r.textureDirectory&&(r.textureDirectory="".concat(r.textureDirectory,"/").replace(/\\/g,"/").replace(/\/+/g,"/"));var a,o,i=r.version;if("1.4.1"!==i&&"1.5.0"!==i)return console.warn("ColladaExporter : Version ".concat(i," not supported for export. Only 1.4.1 and 1.5.0.")),null;function c(e,t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return a=a||document.createElement("canvas"),o=o||a.getContext("2d"),a.width=e.width,a.height=e.height,o.drawImage(e,0,0),function(e){for(var t=atob(e),r=new Uint8Array(t.length),n=0,a=r.length;n<a;n++)r[n]=t.charCodeAt(n);return r}(a.toDataURL("image/".concat(t),1).replace(/^data:image\/(png|jpg);base64,/,""));throw new Error("THREE.ColladaExporter: No valid image data found. Unable to process texture.")}var s,u=["getX","getY","getZ","getW"],l=new n.Ilk;function m(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){for(var t=new Float32Array(3*e.count),r=0,n=e.count;r<n;r++)l.fromBufferAttribute(e,r).convertLinearToSRGB(),t[3*r+0]=l.r,t[3*r+1]=l.g,t[3*r+2]=l.b;return t}if(e.isInterleavedBufferAttribute){for(var a=new e.array.constructor(e.count*e.itemSize),o=e.itemSize,i=0,c=e.count;i<c;i++)for(var s=0;s<o;s++)a[i*o+s]=e[u[s]](i);return a}return e.array}function f(e,t,r,n){var a=m(e,arguments.length>4&&void 0!==arguments[4]&&arguments[4]);return'<source id="'.concat(t,'">')+'<float_array id="'.concat(t,'-array" count="').concat(a.length,'">')+a.join(" ")+"</float_array><technique_common>"+'<accessor source="#'.concat(t,'-array" count="').concat(Math.floor(a.length/e.itemSize),'" stride="').concat(e.itemSize,'">')+r.map((function(e){return'<param name="'.concat(e,'" type="').concat(n,'" />')})).join("")+"</accessor></technique_common></source>"}function p(e){var t=g.get(e);if(void 0===t){t="image-".concat(h.length+1);var n="png",a=e.name||t,o='<image id="'.concat(t,'" name="').concat(a,'">');o+="1.5.0"===i?"<init_from><ref>".concat(r.textureDirectory).concat(a,".").concat(n,"</ref></init_from>"):"<init_from>".concat(r.textureDirectory).concat(a,".").concat(n,"</init_from>"),o+="</image>",h.push(o),g.set(e,t),y.push({directory:r.textureDirectory,name:a,ext:n,data:c(e.image,n),original:e})}return t}var d=new WeakMap,v=new WeakMap,g=new WeakMap,y=[],h=[],b=[],_=[],x=[],w=function e(t){var r='<node name="'.concat(t.name,'">');if(r+=function(e){return e.updateMatrix(),(s=s||new n.yGw).copy(e.matrix),s.transpose(),"<matrix>".concat(s.toArray().join(" "),"</matrix>")}(t),!0===t.isMesh&&null!==t.geometry){var a=function(e){var t,r,n,a=d.get(e);if(!a){var o="Mesh".concat(b.length+1),i=e.index?e.index.count*e.index.itemSize:e.attributes.position.count,c=null!=e.groups&&0!==e.groups.length?e.groups:[{start:0,count:i,materialIndex:0}],s=e.name?' name="'.concat(e.name,'"'):"",u='<geometry id="'.concat(o,'"').concat(s,"><mesh>"),l="".concat(o,"-position"),p="".concat(o,"-vertices");u+=f(e.attributes.position,l,["X","Y","Z"],"float"),u+='<vertices id="'.concat(p,'"><input semantic="POSITION" source="#').concat(l,'" /></vertices>');var v='<input semantic="VERTEX" source="#'.concat(p,'" offset="0" />');if("normal"in e.attributes){var g="".concat(o,"-normal");u+=f(e.attributes.normal,g,["X","Y","Z"],"float"),v+='<input semantic="NORMAL" source="#'.concat(g,'" offset="0" />')}if("uv"in e.attributes){var y="".concat(o,"-texcoord");u+=f(e.attributes.uv,y,["S","T"],"float"),v+='<input semantic="TEXCOORD" source="#'.concat(y,'" offset="0" set="0" />')}if("uv2"in e.attributes){var h="".concat(o,"-texcoord2");u+=f(e.attributes.uv2,h,["S","T"],"float"),v+='<input semantic="TEXCOORD" source="#'.concat(h,'" offset="0" set="1" />')}if("color"in e.attributes){var _="".concat(o,"-color");u+=f(e.attributes.color,_,["R","G","B"],"float",!0),v+='<input semantic="COLOR" source="#'.concat(_,'" offset="0" />')}var x=null;if(e.index)x=m(e.index);else for(var w=0,M=(x=new Array(i)).length;w<M;w++)x[w]=w;for(var E=0,O=c.length;E<O;E++){var D=c[E],C=(t=x,r=D.start,n=D.count,Array.isArray(t)?t.slice(r,r+n):new t.constructor(t.buffer,r*t.BYTES_PER_ELEMENT,n)),S=C.length/3;u+='<triangles material="MESH_MATERIAL_'.concat(D.materialIndex,'" count="').concat(S,'">'),u+=v,u+="<p>".concat(C.join(" "),"</p>"),u+="</triangles>"}u+="</mesh></geometry>",b.push(u),a={meshid:o,bufferGeometry:e},d.set(e,a)}return a}(t.geometry),o=a.meshid,i=a.bufferGeometry,c=null,u=t.material||new n.vBJ,l=Array.isArray(u)?u:[u];c=(i.groups.length>l.length?new Array(i.groups.length):new Array(l.length)).fill().map((function(e,t){return function(e){var t=v.get(e);if(null==t){t="Mat".concat(_.length+1);var r="phong";!0===e.isMeshLambertMaterial?r="lambert":!0===e.isMeshBasicMaterial&&(r="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));var a=e.emissive?e.emissive:new n.Ilk(0,0,0),o=e.color?e.color:new n.Ilk(0,0,0),i=e.specular?e.specular:new n.Ilk(1,1,1),c=e.shininess||0,s=e.reflectivity||0;a.convertLinearToSRGB(),i.convertLinearToSRGB(),o.convertLinearToSRGB();var u="";!0===e.transparent&&(u+="<transparent>"+(e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",e.opacity<1&&(u+="<transparency><float>".concat(e.opacity,"</float></transparency>")));var l='<technique sid="common"><'.concat(r,">")+"<emission>"+(e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':'<color sid="emission">'.concat(a.r," ").concat(a.g," ").concat(a.b," 1</color>"))+"</emission>"+("constant"!==r?"<diffuse>"+(e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':'<color sid="diffuse">'.concat(o.r," ").concat(o.g," ").concat(o.b," 1</color>"))+"</diffuse>":"")+("constant"!==r?"<bump>"+(e.normalMap?'<texture texture="bump-sampler" texcoord="TEXCOORD" />':"")+"</bump>":"")+("phong"===r?'<specular><color sid="specular">'.concat(i.r," ").concat(i.g," ").concat(i.b," 1</color></specular>")+"<shininess>"+(e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':'<float sid="shininess">'.concat(c,"</float>"))+"</shininess>":"")+"<reflective><color>".concat(o.r," ").concat(o.g," ").concat(o.b," 1</color></reflective>")+"<reflectivity><float>".concat(s,"</float></reflectivity>")+u+"</".concat(r,"></technique>"),m='<effect id="'.concat(t,'-effect">')+"<profile_COMMON>"+(e.map?'<newparam sid="diffuse-surface"><surface type="2D">'+"<init_from>".concat(p(e.map),"</init_from>")+'</surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>':"")+(e.specularMap?'<newparam sid="specular-surface"><surface type="2D">'+"<init_from>".concat(p(e.specularMap),"</init_from>")+'</surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>':"")+(e.emissiveMap?'<newparam sid="emissive-surface"><surface type="2D">'+"<init_from>".concat(p(e.emissiveMap),"</init_from>")+'</surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>':"")+(e.normalMap?'<newparam sid="bump-surface"><surface type="2D">'+"<init_from>".concat(p(e.normalMap),"</init_from>")+'</surface></newparam><newparam sid="bump-sampler"><sampler2D><source>bump-surface</source></sampler2D></newparam>':"")+l+(e.side===n.ehD?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>",f=e.name?' name="'.concat(e.name,'"'):"",d='<material id="'.concat(t,'"').concat(f,'><instance_effect url="#').concat(t,'-effect" /></material>');x.push(d),_.push(m),v.set(e,t)}return t}(l[t%l.length])})),r+='<instance_geometry url="#'.concat(o,'">')+(c.length>0?"<bind_material><technique_common>"+c.map((function(e,t){return'<instance_material symbol="MESH_MATERIAL_'.concat(t,'" target="#').concat(e,'" >')+'<bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>'})).join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return t.children.forEach((function(t){return r+=e(t)})),r+="</node>"}(e),M='<?xml version="1.0" encoding="UTF-8" standalone="no" ?>'+'<COLLADA xmlns="'.concat("1.4.1"===i?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/",'" version="').concat(i,'">')+"<asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>"+(null!==r.author?"<author>".concat(r.author,"</author>"):"")+"</contributor>"+"<created>".concat((new Date).toISOString(),"</created>")+"<modified>".concat((new Date).toISOString(),"</modified>")+(null!==r.unitName?'<unit name="'.concat(r.unitName,'" meter="').concat(r.unitMeter,'" />'):"")+"<up_axis>".concat(r.upAxis,"</up_axis>")+"</asset>";M+="<library_images>".concat(h.join(""),"</library_images>"),M+="<library_effects>".concat(_.join(""),"</library_effects>"),M+="<library_materials>".concat(x.join(""),"</library_materials>"),M+="<library_geometries>".concat(b.join(""),"</library_geometries>"),M+='<library_visual_scenes><visual_scene id="Scene" name="scene">'.concat(w,"</visual_scene></library_visual_scenes>"),M+='<scene><instance_visual_scene url="#Scene"/></scene>';var E,O,D,C,S,T,A={data:(E=M+="</COLLADA>",O=/^<\//,D=/(\?>$)|(\/>$)/,C=/<[^>]+>[^<]*<\/[^<]+>/,S=function e(t,r){return r>0?t+e(t,r-1):""},T=0,E.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map((function(e){C.test(e)||D.test(e)||!O.test(e)||T--;var t="".concat(S("  ",T)).concat(e);return C.test(e)||D.test(e)||O.test(e)||T++,t})).join("\n")),textures:y};return"function"==typeof t&&requestAnimationFrame((function(){return t(A)})),A}}],r&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}]);